jQuery(document).ready(function(t){function i(i,o,n){popUp({title:n||"Заполнить данные",width:500,buttons:[{id:"setOperatorData",title:"Готово"}]},function(i){i.wait(),getAjaxHtml("operator/get_operator_data",function(o){i.setData(o),t("#operatorFormAvatar").chooseInputFile(function(i,o){t("#operatorAvatarImg").attr("src",i.src),t("#operatorFilename").text(i.name)}),t("#setOperatorData").on(tapEvent,function(){var o=new FormData(t("#operatorDataForm")[0]);i.wait();var n=!0;""==t("#operatorNick").val()&&(t("#operatorNick").addClass("error"),n=!1),"none"==t("#operatorAvatarImg").attr("src").substr(-8,4)&&(t('[for="operatorFormAvatar"]').addClass("error"),n=!1),n?t.ajax({type:"POST",url:"/operator/set_operator_data",dataType:"json",cache:!1,contentType:!1,processData:!1,data:o,success:function(o){o.error?notify(o.error,"error"):(o.avatar&&t("[operatoravatarimg]").attr("src",o.avatar+"?"+(new Date).getTime()),o.nickname&&t("[operatornickname]").text(o.nickname),notify("Настройки сохранены!"),i.close())},error:function(t){notify("Системная ошибка!","error"),showError(t)},complete:function(){i.wait(!1)}}):i.wait(!1)})},function(){i.wait(!1)})})}clientFileManager(),t("body").on("focus","input, textarea, select",function(){t(this).parent("div").addClass("focused")}),t("body").on("blur","input, textarea, select",function(){t(this).parent("div").removeClass("focused")});var o,n=t(window).height(),e=t("#operatorTopBlock").outerHeight()+t("#operatorBottomBlock").outerHeight();if(n+200>e&&t("#operatorNavBlock").css("max-height",(n-e<200?200:n-e)+"px"),t(window).resize(function(){n=t(window).height(),clearTimeout(o),o=setTimeout(function(){n+200>e&&t("#operatorNavBlock").css("max-height",(n-e<200?200:n-e)+"px")},50)}),"operator"==location.pathname.replace("/","")&&t("[operatoravatarimg]").length>0&&"user"==t("[operatoravatarimg]").attr("src").substr(-8,4)){t("#operatorNickname").val()}if(""==t("#operatorNickname").val()&&i(null,""),t("#changeAvatar, #changeNickname").on(tapEvent,function(){i(t("#changeAvatar").siblings("img").attr("src"),t("#operatorNickname").text(),"Изменить данные")}),t("[operatorlogout]").on(tapEvent,function(){popUp({title:"Выход из кабинета оператора",width:400,html:"<p>Вы действительно хотите выйти?</p>",wrapToClose:!0,winClass:!1,buttons:[{id:"logoutCancel",title:"Отмена",class:"close"},{id:"logoutConfirm",title:"Выйти"}]},function(i){t("#logoutConfirm").on(tapEvent,function(){location="/operator/logout"}),t("#logoutCancel").on(tapEvent,function(){i.close()})})}),contentWait=function(i){void 0!=i&&0==i?(t("#sectionButtons").length>0&&(t("#sectionButtons").find("button.disabled").removeAttrib("disabled"),t("#sectionButtons").find("button.disabled").removeClass("disabled")),t("#sectionContent").removeClass("section__content_wait")):(t("#sectionButtons").length>0&&(t("#sectionButtons").find("button:not(:disabled)").addClass("disabled"),t("#sectionButtons").find("button.disabled").setAttrib("disabled")),t("#sectionContent").addClass("section__content_wait"))},setContentData=function(i,o){o=o||{};var e=location.hash.split(".");t("#contentblockWaitBlock").addClass("wait_visible"),t("#operatorContent").html(""),t("[operatorSections]").find("li").removeClass("active"),t("[operatorSections]").find("li[url="+i+"]").addClass("active"),t.post("/operator/render/"+i,o,function(o){t("#operatorContent").html(o),void 0!=e[1]?(t("#"+i+"Section").find(".tabstitles:not(.sub) li").removeClass("active"),t("#"+i+"Section").find(".tabstitles:not(.sub) li#"+e[1]).addClass("active"),t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find("[tabid]").removeClass("visible"),t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find('[tabid="'+e[1]+'"]').addClass("visible")):(t("#"+i+"Section").find(".tabstitles:not(.sub) li:first").addClass("active"),t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find("[tabid]:first").addClass("visible")),void 0!=e[2]?t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").length>0&&t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").each(function(){t(this).children("li#"+e[2]).length>0?(t(this).children("li").removeClass("active"),t(this).children("li#"+e[2]).addClass("active"),t(this).siblings(".tabscontent").find("[tabid]").removeClass("visible"),t(this).siblings(".tabscontent").find('[tabid="'+e[2]+'"]').addClass("visible")):(t(this).children("li:first").addClass("active"),t(this).siblings(".tabscontent").find("[tabid]:first").addClass("visible"))}):t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").length>0&&t("#"+i+"Section").find(".tabstitles:not(.sub)").siblings(".tabscontent").find(".tabstitles.sub").each(function(){t(this).children("li").removeClass("active"),t(this).children("li:first").addClass("active"),t(this).siblings(".tabscontent").find("[tabid]").removeClass("visible"),t(this).siblings(".tabscontent").find("[tabid]:first").addClass("visible")})},"html").done(function(){t("#contentblockWaitBlock").removeClass("wait_visible");var i,o=t("#sectionContent").offset().top;t("#sectionContent").children("div").css("height",n-o-35+"px"),t(window).resize(function(){n=t(window).height(),o=t("#sectionContent").offset().top,clearTimeout(i),i=setTimeout(function(){t("#sectionContent").children("div").css("height",n-o-35+"px")},50)}),t("#operatorContent").find(".editor").length>0&&initEditors()}).fail(function(t){showError(t),notify("Системная ошибка!","error")})},""!=location.hash){var a=location.hash.substr(1,location.hash.length).split(".");a[0]&&setContentData(a[0])}else setContentData("main");t("[operatorSections]").find("li").on(tapEvent,function(){var i=t(this).attr("url");i&&i!=location.hash.substr(1,location.hash.length)&&(location.hash=i,setTimeout(function(){setContentData(i)},30))})});