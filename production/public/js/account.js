$(document).ready(function(){function t(t){var e=t||"Заполнить данные";popUp({title:e,width:500,winClass:"account",buttons:[{id:"setUserData",title:"Готово"}]},function(t){t.wait();var e=1==$("#isLider").val()?1:0;getAjaxHtml("account/get_account_data",{lider:e},function(e){t.setData(e),$("#updateUserAvatar").chooseInputFile(function(t,e){$("#userAvatarImg").attr("src",t.src),$("#userFilename").text(t.name)});var o=new jBox("Tooltip",{attach:"#chooseColor",trigger:"click",closeOnMouseleave:!0,closeOnClick:"body",addClass:"raiderscolorswrap",outside:"x",ignoreDelay:!0,position:{x:"right",y:"center"},content:'<i class="fa fa-bars"></i>'});getAjaxHtml("account/get_raiders_colors",{attr:"chooseusercolor"},function(t){o.setContent(t),$("[chooseusercolor]").on(tapEvent,function(){var t=$(this).attr("chooseusercolor");$("#userDataForm").find('[name="user_color"]').val(t),$("#chooseColor").css("background-color",t),o.close()})}),$(".popup").scroll(function(){o.close()}),$("#setUserData").on(tapEvent,function(){t.wait();var e=!0;""==$("#updateUserNick").val()&&($("#updateUserNick").addClass("error"),e=!1),"none"==$("#userAvatarImg").attr("src").substr(-8,4)&&($('[for="updateUserAvatar"]').addClass("error"),e=!1),e?$.ajax({type:"POST",url:"/account/update_account_data",dataType:"json",cache:!1,contentType:!1,processData:!1,data:new FormData($("#userDataForm")[0]),success:function(e){e.error?notify(e.error,"error"):(e.avatar&&$("[useravatarimg]").attr("src",e.avatar+"?"+(new Date).getTime()),e.nickname&&$("[accountnickname]").text(e.nickname),e.color&&$("#chooseColor").css("background-color",e.color),notify("Настройки сохранены!"),t.close(function(){1==$("#agreementStat").val()&&getAgrement()}))},error:function(t){notify("Системная ошибка!","error"),showError(t)},complete:function(){t.wait(!1)}}):t.wait(!1)})},function(){t.wait(!1)})})}function e(){var t=$("#accountStatics").find(".slick-slide").length;$("#accountStatics").find(".slick-slide.slick-active").length<t?($(".staticsblock__arrow").addClass("staticsblock__arrow_visible"),$(".staticsblock").addClass("staticsblock__rows")):($(".staticsblock__arrow").removeClass("staticsblock__arrow_visible"),$(".staticsblock").removeClass("staticsblock__rows"))}function o(t){getAjaxHtml("account/get_new_raid_data",{static:t,period:m},function(e){v.setData(e),v.setButtons([{id:"addRaid",title:"Создать рейд"}]),$("#raidStaticTabs").find("li").on(tapEvent,function(){v.correctPosition(100)}),$('[tabid="raidStaticOrders"]').on("keydown",'.popup__table tbody tr:last input[type="text"]',function(){if(0==$(this).val().length){var t=$('[tabid="raidStaticOrders"]').find(".popup__table tbody tr").length,e="";e+="<tr>",e+="<td><p>Заказ "+(t+1)+"</p></td>",e+='<td><div class="popup__field"><input type="text" autocomplete="off" name="raid_orders['+t+']"></div></td>',e+="</tr>",$('[tabid="raidStaticOrders"]').find(".popup__table tbody").append(e)}}),$('[tabid="raidStaticUsers"]').on("change",'input[type="checkbox"]',function(){var t=$(this).is(":checked"),e=$(this).closest("tr");t?$(e).find('input[type="number"]').val("1"):$(e).find('input[type="number"]').val("0")}),$("#addRaid").on(tapEvent,function(){v.wait();var e=!0;if($('select[name="raid_type"]').val()||($('select[name="raid_type"]').addClass("error"),notify("Ошибка! Необходимо выбрать тип рейда","error"),e=!1),e){var o=new FormData($("#newRaidForm")[0]);o.append("static_id",t),$.ajax({type:"POST",url:"/account/add_raid",dataType:"json",cache:!1,contentType:!1,processData:!1,data:o,success:function(t){t?notify("Рейд успешно добавлен!"):notify("Ошибка сохранения данных","error")},error:function(t){notify("Ошибка сохранения данных","error"),showError(t)},complete:function(){v.close()}})}else v.wait(!1)})},function(){v.wait(!1)})}function a(){y.wait(),$.post("/account/get_users_to_compound",{period_id:w,static_id:g,is_lider:_},function(t){t?(y.setWidth(1300),y.setData(t),1==_&&y.setButtons([{id:"setCompoundButton",title:"Обновить"}])):y.setData('<p class="empty center">Нет данных</p>'),y.wait(!1)},"html").fail(function(t){showError(t),notify("Системная ошибка!","error"),y.wait(!1)})}function n(t,e,o){getAjaxHtml("account/get_new_key_data",{static:t,period:e},function(e){o.setData(e),o.setButtons([{id:"addKey",title:"Создать ключ"}]),$("#keyStaticTabs").find("li").on(tapEvent,function(){o.correctPosition(100)}),$("#newKeyForm").on("change",'input[type="checkbox"]',function(){var t=$(this).is(":checked"),e=$(this).closest("tr");t?$(e).find('input[type="number"]').val("1"):$(e).find('input[type="number"]').val("0")}),$("#addKey").on(tapEvent,function(){o.wait();var e=!0;if($('select[name="key_type"]').val()||($('select[name="key_type"]').addClass("error"),notify("Ошибка! Необходимо выбрать тип ключа","error"),e=!1),e){var a=new FormData($("#newKeyForm")[0]);a.append("static_id",t),$.ajax({type:"POST",url:"/account/add_key",dataType:"json",cache:!1,contentType:!1,processData:!1,data:a,success:function(t){t?notify("Ключ успешно добавлен!"):notify("Ошибка сохранения данных","error")},error:function(t){notify("Ошибка сохранения данных","error"),showError(t)},complete:function(){o.setWidth(1e3),b()}})}else o.wait(!1)})},function(){o.wait(!1)})}function i(t,e,o){$.post("/timesheet/get_timesheet_data",{period_id:o,static_id:t,static_name:e},function(t){t?k.setWidth(1330,function(){k.setData(t),k.setTitle(D)}):(k.setTitle(D),k.setData('<p class="empty dark center">Нет данных</p>')),k.wait(!1)},"html").fail(function(t){showError(t),notify("Системная ошибка!","error"),k.wait(!1)})}function s(t,e){$.post("/offtime/get_offtime_dates",{static:t,history:e},function(t){e||S.setWidth(1330),S.setData(t),S.wait(!1)},"html").fail(function(t){showError(t),S.wait(!1),notify("Системная ошибка!","error")})}function r(t,e){A.wait(),$.post("/vacation/get_vacation_dates",{static:t,shift:e},function(t){if(!t)return A.setData('<p class="empty text-center">Запрещено бронировать отпуск в текущем звании!</p>'),A.wait(!1),!0;A.setWidth(1330),A.setData(t),A.wait(!1);var e=parseInt($("#vacationsSpace").val()),o=parseInt($("#vacationsParty").val()),a=parseInt($("#setVacationsLimit").val())+$("#vacationTable tbody tr.edited").children("td.vacated").length;$("#vacationTable").find("tr.edited").multiChoose({item:"[setvacation]:not(.out):not(.confirmed)",cls:"vacated",onChoose:function(t,n,i,s){function r(t){return t=t||0,$(n).children().eq(c+t)}var c=($("#vacationTable tbody tr"),$(t).index()),l=parseInt($(t).attr("setvacation")),d=0,f=0;if(U.setTime(1e3*l),i&&r().hasClass("disabled"))return notify("Запрещено!","info"),!1;if(e){if(i&&0==r(1).hasClass("vacated")&&0==r(-1).hasClass("vacated")){for(var u=2;u<=e;u++)if(r(u).hasClass("vacated")||r(-u).hasClass("vacated"))return!1}else if(i&&0==r(1).hasClass("vacated")){for(var u=2;u<=e;u++)if(r(u).hasClass("vacated"))return!1}else if(i&&0==r(-1).hasClass("vacated"))for(var u=2;u<=e;u++)if(r(-u).hasClass("vacated"))return!1;if(!i&&r(1).hasClass("vacated")&&r(-1).hasClass("vacated")&&e>1)return notify("Нельзя!","info"),!1}if(o){for(;1==r(-(d+1)).hasClass("vacated");)d+=1;for(;1==r(f+1).hasClass("vacated");)f+=1;if(i&&d+f>=o)return notify("Запрещено более "+o+" дн. подряд!","info"),!1}return!(a&&i&&$(n).children("td.vacated").length>=a)||(notify("Лимит бронирования!","info"),!1)}},function(t,e,o){var a=[],n=$(t).attr("vacationuser"),i=$(t).attr("vacationstatic");e&&$.each(e,function(t,e){a.push($(e).attr("setvacation"))}),o?$.post("/vacation/set_vacation_date",{user_id:n,static_id:i,dates:a},function(t){t&&notify("День успешно забронирован")},"json"):$.post("/vacation/unset_vacation_date",{user_id:n,static_id:i,dates:a},function(t){t&&notify("Бронь отменена")},"json")})},"html").fail(function(t){showError(t),A.wait(!1),notify("Системная ошибка!","error")})}$(".scroll").ddrScrollTable(),$(document).on("popup:open",function(){$(".scroll").ddrScrollTable()}),addPayItem=function(t){delete t.from,delete t.template,delete t.title,delete t.to,delete t.site_protocol,delete t.site_url,t.stat=0,t.date=Date.now(),$.post("/admin/add_pay_item",t).fail(function(t){console.log(t.responseText)})},addComplaintsItem=function(t){delete t.from,delete t.template,delete t.title,delete t.to,delete t.site_protocol,delete t.site_url,t.stat=0,t.date=Date.now(),$.post("/admin/add_complaints_item",t).fail(function(t){console.log(t.responseText)})},$("#account").on(tapEvent,function(){popUp({title:"Войти в Личный кабинет",width:460,wrapToClose:!0,winClass:"account",buttons:[{id:"resetPass",title:"Сбросить пароль",class:"link"},{id:"toReg",title:"Регистрация",class:"link"},{id:"getAuth",title:"Войти"}]},function(t){t.wait(),getAjaxHtml("main/auth",{template:1},function(e){t.setData(e),t.correctPosition(),$("#getAuth").on(tapEvent,function(){var t=$("#authEmail").val(),e=$("#authPassword").val();""==t&&($("#authEmail").addClass("error"),notify("Ошибка! Введите логин!","error")),""==e&&($("#authPassword").addClass("error"),notify("Ошибка! Введите пароль!","error")),""!=t&&""!=e&&$.post("/main/auth",{email:t,password:e},function(t){0==t?($("#authEmail, #authPassword").addClass("error"),notify("Ошибка! Введены неверные данные!","error")):1==t?location="/account":2==t&&($("#authEmail, #authPassword").addClass("error"),notify("Ошибка! Доступ ограничен!","error"))},"json").fail(function(t){showError(t),notify("Системная ошибка!","error")})}),$("#toReg").on(tapEvent,function(){t.wait(),getAjaxHtml("main/reg",{template:1},function(e){t.setTitle("Регистрация"),t.setData(e),t.setButtons([{id:"getReg",title:"Зарегистрироваться"}]),t.correctPosition(),$("#getReg").on(tapEvent,function(){t.wait();var e=$("#regEmail").val();password=generateCode("LlnnlLn"),""!=e?$.post("/main/reg",{email:e,password:password},function(e){0==e?($("#regEmail").addClass("error"),notify("Ошибка! Необходимо ввести E-mail!","error")):1==e?($("#regEmail").addClass("error"),notify("Ошибка! Введен некорректный E-mail!","error")):2==e?($("#regEmail").addClass("error"),notify("Ошибка! такой E-mail уже зарегистрирован!","error")):3==e&&(notify("E-mail успешно зарегистрирован"),t.setData('<p class="center">Ваш аккаунт успешно зарегистрирован</p><p class="center">Письмо с регистрационными данными отправлено на ваш E-mail адрес</p>',!0))},"json").done(function(){t.wait(!1)}).fail(function(t){showError(t),notify("Системная ошибка!","error")}):($("#regEmail").addClass("error"),notify("Ошибка! Необходимо заполнить поле!","error"),t.wait(!1))})},function(){t.wait(!1)})}),$("#resetPass").on(tapEvent,function(){var e=$("#authEmail").val(),o=generateCode("LlnnlLn");""==e?($("#authEmail").addClass("error"),notify("Ошибка! Необходимо ввести Ваш E-mail!","error")):(t.wait(),$.post("/main/reset_pass",{email:e,new_password:o},function(t){0==t?($("#authEmail").addClass("error"),notify("Ошибка! Необходимо ввести Ваш E-mail!","error")):1==t?($("#authEmail").addClass("error"),notify("Ошибка! Введен некорректный E-mail!","error")):2==t?($("#authEmail").addClass("error"),notify("Ошибка! Такого E-mail нет в базе!","error")):3==t&&notify("Ваш пароль успешно сброшен и передан на Ваш E-mail!")},"json").done(function(){t.wait(!1)}).fail(function(t){showError(t),notify("Системная ошибка!","error")}))})},function(){t.wait(!1)})})}),$("[logout]").on(tapEvent,function(){popUp({title:"Выход из личного кабинета",width:400,html:"Вы действительно хотите выйти?",buttons:[{id:"logoutCancel",title:"Отмена",class:"close"},{id:"logoutConfirm",title:"Выйти"}]},function(t){$("#logoutConfirm").on(tapEvent,function(){location="/account/logout"}),$("#logoutCancel").on(tapEvent,function(){t.close()})})}),"account"==location.pathname.replace("/","")&&0==$("#isUserData").val()&&t(),$("#changeAvatar, #changeNickname").on(tapEvent,function(){t("Изменить данные")});var c,l,d;$(".start__bg").find("img").load(function(){c=Math.ceil($("#startBgTop").outerHeight()),l=Math.ceil($("#startBgBottom").outerHeight()),$("#startContent").css("min-height",c+l+"px")}),$(window).resize(function(){clearTimeout(d),d=setTimeout(function(){c=Math.ceil($("#startBgTop").outerHeight()),l=Math.ceil($("#startBgBottom").outerHeight()),$("#startContent").css("min-height",c+l+"px")},50)});var f,u=$(window).height(),p=$("#accountTopBlock").outerHeight()+$("#accountBottomBlock").outerHeight();u+200>p&&$("#accountNavBlock").css("max-height",(u-p<200?200:u-p)+"px"),$(window).resize(function(){u=$(window).height(),clearTimeout(f),f=setTimeout(function(){u+200>p&&$("#accountNavBlock").css("max-height",(u-p<200?200:u-p)+"px")},50)}),0==$("#staticLiderButtons").length?$(".staticusers").css("max-height","calc(100vh - 204px)"):$(".staticusers").css("max-height","calc(100vh - 274px)");var f;$("#accountStatics").on("init",function(t){$(".staticsblock").addClass("staticsblock__visible"),e(),$(window).resize(function(){clearTimeout(f),f=setTimeout(function(){e()},50)})}),$("#accountStatics").slick({infinite:!1,dots:!1,autoplay:!1,autoplaySpeed:3e3,pauseOnHover:!0,fade:!1,speed:200,draggable:!0,arrows:!1,mobileFirst:!0,slidesToScroll:1,slidesToShow:1,responsive:[{breakpoint:450,settings:{slidesToShow:2}},{breakpoint:576,settings:{slidesToShow:2}},{breakpoint:768,settings:{slidesToShow:2}},{breakpoint:992,settings:{slidesToShow:3}},{breakpoint:1590,settings:{slidesToShow:5}}]}),$("#primarySlidesnav").find("li:first").addClass("active"),$("#primarySlidesnav").find("li").on(tapEvent,function(){var t=$(this).index();console.log(t),$("#accountStatics").slick("slickGoTo",t)}),$("#staticsPrev").on(tapEvent,function(){$("#accountStatics").slick("slickPrev")}),$("#staticsNext").on(tapEvent,function(){$("#accountStatics").slick("slickNext")}),$("#accountStatics").on("beforeChange",function(t,e,o,a){$("#primarySlidesnav").find("li").removeClass("active"),$("#primarySlidesnav").find("li").eq(a).addClass("active")}),$(".staticscontent:first-of-type").css("display","block"),$("[accountstatic]").on(tapEvent,function(){var t=$(this).attr("accountstatic");$("[accountstatic]").removeClass("active"),$(this).addClass("active"),$("[staticscontent]").removeClass("staticscontent_visible"),$('[staticscontent="'+t+'"]').addClass("staticscontent_visible")}),$("[operators]").on(tapEvent,function(){popUp({title:"Операторы",width:1300},function(t){t.wait(),getAjaxHtml("account/get_operators",function(e){t.setData(e),$("[operatorsendmess], [operatorsendcomplain]").on(tapEvent,function(e){t.wait();var o,a,n=$(this).attr("operatorsendmess")||$(this).attr("operatorsendcomplain"),i=n.split("|"),s=i[0],r=i[1],c=i[2];"mess"==c?(o="Новое сообщение",a="Отправить сообщение"):"complain"==c&&(o="Новая жалоба",a="Отправить жалобу"),getAjaxHtml("account/operator_new_mess",{type:c,id:s,nickname:r},function(e){t.setData(e),t.setWidth(500),t.setTitle(o),t.setButtons([{id:"sendMessToOperator",title:a}]),$("#sendMessToOperator").on(tapEvent,function(){var e=$("#messToOperator").val();""==e?($("#messToOperator").addClass("error"),notify("Ошибка! Сообщение не может быть пустым!","error")):(t.wait(),$.post("/account/operator_send_mess",{type:c,message:e,to:s},function(e){e&&(t.wait(!1),t.close(),"mess"==c?notify("Сообщение успешно отправлено!"):"complain"==c&&notify("Жалоба успешно отправлена!"))}).fail(function(t){notify("Системная ошибка!","error"),showError(t)}))})},function(){t.wait(!1)})})},function(){t.wait(!1)})})}),$("#staticSendMessage").on(tapEvent,function(){console.log("fh fh")}),1==$("#agreementStat").val()&&0!=$("#isUserData").val()&&function(){popUp({title:"Договор",width:1300,html:'<div id="agreementBlock"></div>',wrapToClose:!1,winClass:"account",closeButton:"Закрыть"},function(t){h=t,h.wait();var e=$.Deferred(),o=$.Deferred();$.post("/account/get_agreement_data",function(t){e.resolve(t)},"html"),$.post("/account/get_agreement_stat",function(t){o.resolve(t)},"json"),$.when(e,o).then(function(t,e){$("#agreementBlock").html(t),0==e&&h.setButtons([{id:"agreementSuccess",title:"Согласен(на)"}]),h.wait(!1)}).fail(function(t){notify("Системная ошибка!","error"),showError(t),h.wait(!1)})})}();var h;$("body").off(tapEvent,"#agreementSuccess").on(tapEvent,"#agreementSuccess",function(){$.post("/account/set_agreement_stat",{stat:1},function(t){t&&(notify("Соглашение принято!"),$("#agreementSuccess").prop("disabled",!0),$("#agreementStat").val(1),h.close())},"json").fail(function(t){showError(t),notify("Системная ошибка!","error")})}),$("[importantinfo]").on(tapEvent,function(){popUp({title:"Важная информация",width:1300,height:!1,html:'<div id="infoBlock"></div>',wrapToClose:!0,winClass:"account",buttons:!1,closeButton:!1},function(t){t.wait(),getAjaxHtml("account/get_info",function(e){$("#infoBlock").html(e),$(".tabstitles li").on(tapEvent,function(){t.correctPosition(100)})},function(){t.wait(!1)})})});var v,m;$("[newraid]").on(tapEvent,function(){var t=$(this).attr("newraid");popUp({title:"Новый рейд",width:800,winClass:"account"},function(e){v=e,v.wait(),$.post("/account/get_active_period",{static:t},function(e){e?(m=e,o(t)):(v.setData('<p class="empty center">Нет активных периодов!</p>'),v.wait(!1)),$(".tabstitles li").on(tapEvent,function(){infoWin.correctPosition(100)})},"json").fail(function(t){showError(t),notify("Системная ошибка!","error"),v.wait(!1)})})});var y,w,g,_;$("[setcompound]").on(tapEvent,function(){var t=$(this).attr("setcompound").split("|");g=t[0],_=t[1],popUp({title:"Коэффициенты команды",width:500,winClass:"account",buttons:!1},function(t){y=t,y.wait(),getAjaxHtml("account/get_reports_periods",function(t,e){e?y.setData(t):y.setData('<p class="empty center">Нет активных периодов!</p>')},function(){y.wait(!1)})})}),$("body").off(tapEvent,"[periodtocompound]").on(tapEvent,"[periodtocompound]",function(){w=$(this).attr("periodtocompound"),a()}),$("body").off(tapEvent,"#setCompoundButton").on(tapEvent,"#setCompoundButton",function(){y.wait();var t=new FormData($("#compoundForm")[0]);t.append("period_id",w),t.append("static_id",g);var e=[],o=[];$("#koeffsData").find("[editkoeff]").each(function(t,o){var a=$(o).attr("editkoeff").split("|"),n=$(o).val();e.push({id:a[0],user_id:a[1],raid_id:a[2],rate:n})}),$("#koeffsData").find("[editraidtype]").each(function(t,e){var a=$(e).attr("editraidtype"),n=$(e).val();o.push({id:a,type:n})}),t.append("koeffs",JSON.stringify(e)),t.append("r_types",JSON.stringify(o)),$.ajax({type:"POST",url:"/account/set_compound",dataType:"json",cache:!1,contentType:!1,processData:!1,data:t,success:function(t){t?notify("Состав команды успешно обновлен!"):notify("Ошибка сохранения данных","error")},error:function(t){showError(t),notify("Системная ошибка!","error")},complete:function(){y.close()}})});var b;$("[setkeys]").on(tapEvent,function(){var t,e=$(this).attr("setkeys").split("|"),o=e[0],a=parseInt(e[1]);popUp({title:"Ключи",width:1e3,winClass:"account",buttons:!1},function(e){e.wait(),$.post("/account/get_active_period",{static:o},function(i){t=i,t?(e.setTitle("Ключи - "+t.name),(b=function(){getAjaxHtml("account/get_users_to_keys",{period_id:t.id,static_id:o,is_lider:a},function(t,o){e.setData(t),o&&a&&e.setButtons([{id:"saveKeyCoefficients",title:"Сохранить",disabled:1},{id:"newKeyButton",title:"Новый ключ"}])},function(){e.wait(!1),$("body").off("keyup change","[editkeykoeff]").on("keyup change","[editkeykoeff]",function(t){$(this).closest("td").addClass("changed"),$("#saveKeyCoefficients").removeAttrib("disabled")}),$("body").off("change","[editkeytype]").on("change","[editkeytype]",function(t){$(this).closest("td").addClass("changed"),$("#saveKeyCoefficients").removeAttrib("disabled")}),$("body").off(tapEvent,"#saveKeyCoefficients").on(tapEvent,"#saveKeyCoefficients",function(){e.wait();var t=[],o=[];$("body").find("[editkeykoeff]").each(function(e,o){var a=$(o).attr("editkeykoeff").split("|"),n=$(o).val();t.push({user_id:a[0],raid_id:a[1],koeff:n})}),$("body").find("[editkeytype]").each(function(t,e){var a=$(e).attr("editkeytype"),n=$(e).val();o.push({id:a,type:n})}),$.post("/account/edit_key_data",{koeffs:t,k_types:o},function(t){t?(notify("Данные сохранены!"),foo()):notify("Ошибка сохранения данных!","error")})}),$("#newKeyButton").on(tapEvent,function(){e.setWidth(800),n(o,t,e)})})})()):(e.setData('<p class="empty center">Нет активных периодов!</p>'),e.wait(!1))},"json").fail(function(t){showError(t),notify("Системная ошибка!","error"),e.wait(!1)})})});var E,C;$("[reportpatternsbutton]").on(tapEvent,function(){popUp({title:"Выплаты",width:800,html:'<div id="reportPatternsList"></div>',winClass:"account",buttons:[{id:"getEarlyPatterns",title:"Показать более ранние"}],closeButton:"Закрыть"},function(t){E=t,C=0,E.wait();getAjaxHtml("reports/get_main_reports_patterns",{to_user:1,limit:10,offset:C},function(t){$("#reportPatternsList").html(t)},function(){E.wait(!1)})})}),$("body").off(tapEvent,"#getEarlyPatterns").on(tapEvent,"#getEarlyPatterns",function(){E.wait(),C+=10,getAjaxHtml("reports/get_main_reports_patterns",{to_user:1,limit:10,offset:C},function(t,e){e?$("#reportPatternsList").html(t):($("#getEarlyPatterns").setAttrib("disabled"),notify("Это последние записи.","info"))},function(){E.wait(!1)})}),$("body").off(tapEvent,"[patternid]").on(tapEvent,"[patternid]",function(){E.wait();var t=$(this).attr("patternid"),e=$(this).attr("patternname");getAjaxHtml("reports/get_main_report",{from_pattern:1,to_user:1,pattern_id:t},function(t,o){E.setTitle("Отчет по выплатам - "+e),o?E.setWidth(1330,function(){E.setData(t,!0)}):E.setData('<p class="empty center">Нет данных</p>',!0)},function(){E.wait(!1)})}),$("body").off(tapEvent,"[patternkeyid]").on(tapEvent,"[patternkeyid]",function(){E.wait();var t=$(this).attr("patternkeyid"),e=$(this).attr("patternname");getAjaxHtml("reports/get_keys_report",{from_pattern:1,to_user:1,pattern_id:t},function(t,o){E.setTitle("Отчет по выплатам - "+e),o?E.setWidth(1058,function(){E.setData(t,!0)}):E.setData('<p class="empty center">Нет данных</p>',!0)},function(){E.wait(!1)})});var k,x,D,T;$("[timesheetperiodbutton]").on(tapEvent,function(){popUp({title:"Периоды расписания",width:520,winClass:"account"},function(t){k=t,k.wait(),$.post("/timesheet/get_timesheet_periods",{to_user:1},function(t){t?k.setData(t):k.setData('<p class="empty center">Нет данных</p>'),k.wait(!1)},"html").fail(function(t){k.wait(!1),showError(t),notify("Системная ошибка!","error")})})}),$("body").off(tapEvent,"[choosetimesheetperiod]").on(tapEvent,"[choosetimesheetperiod]",function(){k.wait(),x=$(this).attr("choosetimesheetperiod"),D=$(this).children("span").text(),$.post("/account/get_statics",{attr:"statictotimesheet"},function(t){if(1==$(t).find("[statictotimesheet]").length){var e=$(t).find("[statictotimesheet]").attr("statictotimesheet");T=$(t).find("[statictotimesheet] span").text(),i(e,T,x)}else k.setData(t);k.wait(!1)},"html").fail(function(t){showError(t),notify("Системная ошибка!","error"),k.wait(!1)})}),$("body").off(tapEvent,"[statictotimesheet]").on(tapEvent,"[statictotimesheet]",function(){k.wait(),i($(this).attr("statictotimesheet"),T,x)});var S,j,B=0;$("[getofftime]").on(tapEvent,function(){popUp({title:"Забронировать выходной",width:500,winClass:"account"},function(t){S=t,S.wait(),getAjaxHtml("account/get_statics",{attr:"statictoofftime"},function(t){1==$(t).find("[statictoofftime]").length?s($(t).find("[statictoofftime]").attr("statictoofftime")):S.setData(t)},function(){S.wait(!1)})})}),$("body").off(tapEvent,"[statictoofftime]").on(tapEvent,"[statictoofftime]",function(){S.wait(),j=$(this).attr("statictoofftime"),s(j)}),$("body").off(tapEvent,"[offtimehistory]").on(tapEvent,"[offtimehistory]",function(){var t=$(this).attr("offtimehistory");B="+"==t?B+1:B-1,0==B?$('[offtimehistory="+"]').setAttrib("disabled"):$('[offtimehistory="+"]').removeAttrib("disabled"),S.wait(),s(j,B)}),$("body").off(tapEvent,"[setofftime]").on(tapEvent,"[setofftime]",function(){var t=$(this).attr("setofftime").split("|");params={user_id:t[0],static:t[1],role:t[2],date:t[3]},$.post("/offtime/set_offtime",params,function(t){t?(S.setData(t),notify("Выходной успешно забронирован!")):notify("Лимит выходных на данный месяц исчерпан!","info")},"html").fail(function(t){showError(t),notify("Системная ошибка!","error")})}),$("body").off(tapEvent,"[unsetofftime]").on(tapEvent,"[unsetofftime]",function(){var t=$(this).attr("unsetofftime").split("|");$.post("/offtime/unset_offtime",{id:t[0],static:t[1]},function(t){t?(S.setData(t),notify("Выходной отменен!","info")):notify("Ошибка! Выходной не отменен!","error")},"html").fail(function(t){showError(t),notify("Системная ошибка!","error")})});var A,H,P,U=new Date;$("[getvacation]").on(tapEvent,function(){popUp({title:"Забронировать отпуск",width:500,winClass:"account"},function(t){A=t,A.wait(),P=4,getAjaxHtml("account/get_statics",{attr:"statictovacation"},function(t){1==$(t).find("[statictovacation]").length?(H=$(t).find("[statictovacation]").attr("statictovacation"),r(H,P)):A.setData(t)},function(){A.wait(!1)})})}),$("body").off(tapEvent,"[statictovacation]").on(tapEvent,"[statictovacation]",function(){A.wait(),H=$(this).attr("statictovacation"),console.log(H,P),r(H,P)}),$("body").off(tapEvent,"[vacationshift]").on(tapEvent,"[vacationshift]",function(){var t=$(this).attr("vacationshift");"prev"==t&&-4!=P?(P=-4,r(H,P)):"next"==t&&4!=P&&(P=4,r(H,P))}),$("[guideschapter]:not([guideropensubnav])").on(tapEvent,function(){if($(this).hasClass("active"))return!1;$("[guideschapter]").removeClass("active"),$(this).addClass("active");var t=$(this).attr("guideschapter");$(".contentblock__wait").addClass("contentblock__wait_visible"),$("#guidesContent").html(""),getAjaxHtml("account/get_guide_chapter",{id:t},function(e){$("#guidesContent").html(e),location.hash=t},function(){$(".contentblock__wait").removeClass("contentblock__wait_visible")})});var O=location.hash.substr(1,location.hash.length);""!=O&&($(".contentblock__wait").addClass("contentblock__wait_visible"),getAjaxHtml("account/get_guide_chapter",{id:O},function(t){$("#guidesContent").html(t)},function(){$(".contentblock__wait").removeClass("contentblock__wait_visible"),$('[guideschapter="'+O+'"]').addClass("active"),$('[guideschapter="'+O+'"]').closest("li").parents("li").addClass("opened")})),$("[guideropensubnav]").on(tapEvent,function(){$(this).closest("li").hasClass("opened")?($(this).closest("li").removeClass("opened"),$("#accountNavBlock").find("li").removeClass("opened")):($("#accountNavBlock").find("li").removeClass("opened"),$(this).closest("li").addClass("opened"))}),$("[showstatistics]").on(tapEvent,function(){popUp({title:"Статистика",width:800,closeButton:"Закрыть"},function(t){t.wait(),getAjaxHtml("account/statistics_get",function(e){t.setData(e),t.wait(!1)},function(){})})}),$("[getpersonages]").on(tapEvent,function(){popUp({title:"Мои персонажи",width:800,wrapToClose:!0,winClass:!1,closeButton:"Закрыть"},function(t){t.wait(),getAjaxHtml("account/personages/main",function(e){t.setData(e),$("#personesList").ddrCRUD({addSelector:"#addPersonage",functions:"account/personages"},function(e){t.wait(!1)})},function(){t.wait(!1)})})}),$("[paymentorders]").on(tapEvent,function(){popUp({title:"Заявки на оплату",width:1e3,height:!1,html:'<div id="paymentRequestsWin"></div>',wrapToClose:!0,winClass:"account",buttons:!1,closeButton:!1},function(t){getAjaxHtml("account/get_payment_requests",function(t){$("#paymentRequestsWin").html(t)},function(){$(".tabstitles li:first").addClass("active"),$(".tabscontent > *:first").addClass("visible"),$(".tabstitles li").on(tapEvent,function(){t.correctPosition(100)})})})});var F,W,K=new jBox("Tooltip",{attach:"[setstaticusercolor]",trigger:"click",closeOnMouseleave:!0,addClass:"raiderscolorswrap",outside:"x",ignoreDelay:!0,position:{x:"right",y:"center"},content:'<i class="fa fa-bars"></i>'});getAjaxHtml("account/get_raiders_colors",{},function(t){K.setContent(t)}),$("body").on(tapEvent,function(t){0==$("[setstaticusercolor]:hover").length&&$("body").find(".raiderscolorswrap:visible").length>0&&0==$("body").find(".raiderscolors:hover").length&&K.close()}),$("[setstaticusercolor]").on(tapEvent,function(){F=$(this).closest("[userid]").attr("userid"),W=this}),$("body").on(tapEvent,"[chooseraidercolor]",function(){var t=$(this).attr("chooseraidercolor");$.post("/account/change_user_color",{user_id:F,color:t},function(e){e?(notify("Цвет пользователя задан!"),$(W).css("background-color",t),K.close()):notify("Ошибка! Цвет пользователя не задан!","error")})})});