function ClientFileManager(){var e,t,n,o="",i={images:"png|jpg|jpeg|gif|ico|bmp",videos:"mp4|avi|mov|wmv|mpeg|3gp|flv|m4v|mpg|swf",audios:"mp3|wav|wma|m3u|ogg|wav|wave",docs:"doc|docx|pdf|ppt|pptx|rtf|xls|xlsx|txt"};o+='<div class="filemanager__client" id="clientFileManager">',o+='<div class="filemanager__topdirs mb-2">',o+='<ul class="filemanager__dirstree noselect" id="clientFilemanagerDirs"></ul>',o+="</div>",o+='<div class="filemanager__bottomfiles">',o+='<div class="filemanager__content_files filemanager__content_clientfiles noselect" id="clientFilemanagerContentFiles">',o+='<p class="empty center">Выберите раздел</p>',o+="</div>",o+="</div>",o+="</div>",$("body").append(o),$("body").on(tapEvent,"[filemanager]",function(){n=lscache.get("clientmanagerdir")||!1,t=this,e=$(this).attr("filemanager")||0,void 0!=i[e]&&(e=i[e]),n&&(getAjaxHtml("filemanager/files_get",{directory:n,filetypes:e},function(e){$("#clientFilemanagerContentFiles").html(e)}),getAjaxHtml("filemanager/dirs_get",{current_dir:n},function(e){$("#clientFilemanagerDirs").html(e)})),0==$("#clientFileManager").hasClass("visible")&&$("#clientFileManager").addClass("visible")}),$("body").on(tapEvent,".filemanager_remove",function(){var e=$(this).closest(".file");$(e).find(".image_name").text("нет файла"),$(e).find("img").attr("src","./public/images/none.png"),$(e).find('input[type="hidden"]').val("")}),getAjaxHtml("filemanager/dirs_get",{current_dir:n},function(e){$("#clientFilemanagerDirs").html(e)}),$("#clientFilemanagerDirs").on(tapEvent,"[directory]:not(.disabled):not(.active)",function(){var t=$(this).attr("directory");lscache.set("clientmanagerdir",t),$("#clientFilemanagerDirs").find("[directory]").removeClass("active"),$(this).addClass("active"),getAjaxHtml("filemanager/files_get",{directory:t,filetypes:e},function(e){$("#clientFilemanagerContentFiles").html(e)})}),$("#clientFilemanagerContentFiles").on(tapEvent,".image",function(){if(0==$(t).closest(".file").find('input[type="hidden"]').length)return!1;var e=$(this).closest(".file"),n=$(e).attr("dirfile"),o=$(e).attr("namefile"),i=$(this).find("img").attr("src");$(t).closest(".file").find('input[type="hidden"]').val(n),$(t).find("img").attr("src",i),$(t).closest(".file").find(".image_name").text(o),$("#clientFileManager").removeClass("visible")}),$("body").on(tapEvent,function(){$("#clientFileManager").is(":hover")||0!=$("[filemanager]:hover").length||0!=$(".editorfile:hover").length||$("#clientFileManager").hasClass("visible")&&$("#clientFileManager").removeClass("visible")}),$("#clientFileManager").on("mouseenter",function(){disableScroll()}),$("#clientFileManager").on("mouseleave",function(){enableScroll()})}tapEvent="ontouchstart"in window?"tap":"click",thisDevice="desktop",/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(thisDevice="mobile"),monthNames={1:"января",2:"февраля",3:"марта",4:"апреля",5:"мая",6:"июня",7:"июля",8:"августа",9:"сентября",10:"октября",11:"ноября",12:"декабря"},Counter=function(e,t,n){var o=e||0;return function(e){return o=void 0!=e?e:o,void 0==t||"+"==t?"-"==t?o-=n:o+=n:o-=n}},$.fn.setAttrib=function(e,t){return void 0!=e&&(0!=$(this).length&&($(this).prop(e,t||!0),void $(this)[0].setAttribute(e,t||!0)))},$.fn.removeAttrib=function(e){return void 0!=e&&(0!=$(this).length&&($(this).prop(e,!1),void $(this)[0].removeAttribute(e)))},disableScroll=function(){var e=[self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop],t=$("html");t.data("scroll-position",e),t.data("previous-overflow",t.css("overflow")),t.css("overflow","hidden"),window.scrollTo(e[0],e[1])},enableScroll=function(){var e=jQuery("html"),t=e.data("scroll-position");e.css("overflow",e.data("previous-overflow")),window.scrollTo(t[0],t[1])},random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},generateCode=function(e){for(var t=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n="",o=0;o<e.length;o++)"l"==e.substr(o,1)?n+=t[random(0,25)]:"L"==e.substr(o,1)?n+=t[random(0,25)].toUpperCase():"n"==e.substr(o,1)&&(n+=random(0,9));return n},getArgs=function(e){var t,n=location.search.substr(1,location.search.length).split("&"),o=[];return $.each(n,function(e,n){t=n.split("="),o[t[0]]=t[1]}),void 0!=e&&void 0!=o[e]?o[e]:(void 0==e||void 0!=o[e])&&o},urlExists=function(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!=t.status},renderTwig=function(e,t,n){var o=$.extend({block:e},t);$.ajax({type:"POST",url:"/main/render",dataType:"html",data:o,success:function(e){n(e)},error:function(e){console.log(e.responseText)}})},renderTwigAdmin=function(e,t,n){var o=$.extend({block:e},t);$.ajax({type:"POST",url:"/admin/render",dataType:"html",data:o,success:function(e){initEditors(),n(e)},error:function(e){notify("Системная ошибка","error"),console.log(e.responseText)}})},dynamicList=function(e){var t=$.extend({listBlock:"",addButton:"",template:"",removeButton:"",phpFunctionRemove:"",removeCallback:!1,removeQuestion:"Удалить?",removeMessage:"Успешно!",onAdd:!1},e);"/"!=t.phpFunctionRemove.substr(0,1)&&(t.phpFunctionRemove="/"+t.phpFunctionRemove),$(t.addButton).on(tapEvent,function(){renderTwigAdmin("render/"+t.template,{index:$(t.listBlock).find(".list_item").length},function(e){$(t.listBlock).has(".empty")&&$(t.listBlock).find(".empty").remove(),$(t.listBlock).append(e),t.onAdd&&t.onAdd($(t.listBlock).find(".list_item:last"))})}),$("body").on(tapEvent,t.removeButton,function(){var e=this,n=$(e).data("id");popUp({title:t.removeQuestion,width:500,buttons:[{id:"remove"+n,title:"Удалить"}],closeButton:"Отмена"},function(o){$("#remove"+n).on(tapEvent,function(){$.post(t.phpFunctionRemove,{id:n},function(n){n?(1==$(t.listBlock).find(".list_item").length&&$(t.listBlock).append('<p class="empty">Нет данных</p>'),$(e).closest(".list_item").remove(),notify(t.removeMessage),t.removeCallback&&"function"==typeof t.removeCallback&&t.removeCallback()):notify("Ошибка!","error")},"json").always(function(){o.close()}).fail(function(e){showError(e),notify("Системная ошибка!","error")})})})})},$.fn.changeInputs=function(e){function t(e){return{t:e.type,k:e.keyCode,s:e.currentTarget.localName,st:void 0==e.currentTarget.type?"contenteditable":e.currentTarget.type.replace("select-one","select"),isShiftKey:e.shiftKey,isCtrlKey:e.ctrlKey,codeShift:16==e.keyCode,codeCtrl:17==e.keyCode,codeEnter:13==e.keyCode,codeX:88==e.keyCode,codeV:86==e.keyCode}}function n(t,n){e(t,n)}if(0==this.length)return console.warn("changeInputs ошибка! Селектор: не найден!"),!1;if(void 0==e||"function"!=typeof e)return console.warn("changeInputs ошибка! callback функция не задана!"),!1;var o=this;$(o).on("change",'select, input[type="checkbox"], input[type="radio"], input[type="color"], input[type="number"]',function(e){n(this,t(e))});var i;$(o).on("keyup keydown","input, textarea, [contenteditable]",function(e){var o=this,r=t(e);if(-1!=["text","password","email","tel","number"].indexOf(r.st)||"textarea"==r.s&&!r.codeShift&&!r.codeCtrl||"contenteditable"==r.st)if("keydown"==r.t)i=$(o).val()||$(o).html();else if("keyup"==r.t){var a=$(o).val()||$(o).html();(i!==a||"contenteditable"==r.st&&r.codeEnter)&&(i=a,n(o,r))}})},$.fn.changeRowInputs=function(e){function t(e){return{t:e.type,k:e.keyCode,s:e.currentTarget.localName,st:e.currentTarget.type.replace("select-one","select"),isShiftKey:e.shiftKey,isCtrlKey:e.ctrlKey,codeShift:16==e.keyCode,codeCtrl:17==e.keyCode,codeEnter:13==e.keyCode,codeX:88==e.keyCode,codeV:86==e.keyCode}}function n(t,n){var o=$(t).closest(r+a);e(o,t,n)}if(0==this.length)return console.warn("changeInputs ошибка! Селектор: не найден!"),!1;if(void 0==e||"function"!=typeof e)return console.warn("changeInputs ошибка! callback функция не задана!"),!1;var o=this,i=$(o).children()[0];if(!i)return!1;var r=i.localName||"",a=$(i).className?"."+i.className:"";$(o).on("change",'select, input[type="checkbox"], input[type="radio"], input[type="color"], input[type="number"]',function(e){n(this,t(e).st)});var s;$(o).on("keyup keydown","input, textarea, [contenteditable]",function(e){var o=this,i=t(e);if(-1!=["text","password","email","tel","number"].indexOf(i.st)||"textarea"==i.s&&!i.codeShift&&!i.codeCtrl||"contenteditable"==i.st)if("keydown"==i.t)s=$(o).val()||$(o).html();else if("keyup"==i.t){var r=$(o).val()||$(o).html();(s!==r||"contenteditable"==i.st&&i.codeEnter)&&(s=r,n(o,i))}})},showError=function(e){var t=generateCode("lLLnnn");if($("body").find(".show_error").length>0&&$("body").find(".show_error").remove(),e.responseText){var n,o="<div>"+e.responseText+"</div>";n=$(o).find("#container").length>0?'<div class="show_error"><div>'+$(o).find("#container").html()+'</div><button id="'+t+'">Закрыть</button></div>':'<div class="show_error"><div>'+e.responseText+'</div><button id="'+t+'">Закрыть</button></div>',$("body").append(n),$("#"+t).on(tapEvent,function(){$(this).parent(".show_error").remove()})}},getAjaxHtml=function(){var e=arguments,t="string"==typeof e[0]&&("/"!=e[0].substr(0,1)?"/"+e[0]:e[0]),n="object"==typeof e[1]?e[1]:{},o="function"==typeof e[1]?e[1]:void 0!==e[2]&&e[2],i="object"!=typeof e[1]?void 0!==e[2]&&"function"==typeof e[2]&&e[2]:void 0!==e[3]&&"function"==typeof e[3]&&e[3];$.post(t,n,function(e){e=e.trim(),e&&o?o(e,!0):o&&o('<p class="empty center">Нет данных</p>',!1)},"html").always(function(){i&&i()}).fail(function(e){notify("Системная ошибка!","error"),showError(e)})},sendFormData=function(e,t){if(void 0==e||void 0==t.url)return!1;var n=new FormData($(e)[0]),o="/"!=t.url.substr(0,1)?"/"+t.url:t.url;t.params&&$.each(t.params,function(e,t){n.append(e,t)}),$.ajax({type:t.type||"POST",url:o,dataType:t.dataType||"json",cache:!1,contentType:!1,processData:!1,data:n,success:function(e){t.success&&"function"==typeof t.success&&t.success(e)},error:function(e,n){notify("Системная ошибка отправки данных!","error"),showError(e),t.error&&"function"==typeof t.error&&t.error(n)},complete:function(){t.complete&&"function"==typeof t.complete&&t.complete()}})},initEditors=function(e){var t=[],n=[];for(i=0;i<100;i++)t.push(""+i),n.push(i+"px");var o={disableDragAndDrop:!0,height:500,lang:"en-US",emptyPara:"",lineHeights:n,fontSizes:t,codeviewFilter:!1,codeviewIframeFilter:!0,disableGrammar:!0,codemirror:{theme:"monokai"},toolbar:[["font",["bold","italic","underline","clear"]],["height",["height"]],["style",["style"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","image","video"]],["view",["fullscreen","codeview"]]],buttons:{image:function(e){return $.summernote.ui.button({contents:'<i class="note-icon-picture" />',tooltip:"тултип",className:"editorfile",click:function(){(currentDir=lscache.get("clientmanagerdir"))&&(getAjaxHtml("filemanager/files_get",{directory:currentDir,filetypes:"png|jpg|jpeg|gif|ico|bmp"},function(e){$("#clientFilemanagerContentFiles").html(e)}),getAjaxHtml("filemanager/dirs_get",{current_dir:currentDir},function(e){$("#clientFilemanagerDirs").html(e)})),0==$("#clientFileManager").hasClass("visible")&&$("#clientFileManager").addClass("visible"),$("#clientFilemanagerContentFiles").off(tapEvent,".image").on(tapEvent,".image",function(){var t=$(this).closest(".file"),n=$(t).attr("dirfile");$(t).attr("namefile"),$(this).find("img").attr("src"),e.invoke("editor.insertImage",location.origin+"/public/filemanager/"+n),$("#clientFileManager").removeClass("visible")})}}).render()}}};$(e).not(".summernote_activated").summernote(o),$(e).addClass("summernote_activated")},$.fn.chooseInputFile=function(e){var t,n,o=this;$(o).on("change",function(i){return"file"==i.currentTarget.type&&(!!(n=o[0].files[0])&&(t=new FileReader,t.onload=function(t){var i=t.target.result.split("/")[0].substr(5,t.target.result.split("/")[0].length),r=n.name.split(".");e&&"function"==typeof e&&e({name:n.name,ext:r[r.length-1],type:i,size:n.size,src:t.target.result},o)},void t.readAsDataURL(n)))})},onChangeTabs=function(e){$(document).on("changetabs",function(t,n,o){"function"==typeof e&&e(n,o)})},$.fn.multiChoose=function(e,t){var n=$.extend({item:!1,cls:"choosed",onChoose:!0},e),o=this,i=!1,r=!1,a=[];$(o).off("mousedown mouseup",n.item).on("mousedown mouseup",n.item,function(e){var s=this;"mousedown"==e.type?(i=!0,a=[],0==$(s).hasClass(n.cls)?1==n.onChoose||"function"==typeof n.onChoose&&n.onChoose(s,o,!0,!0)?($(s).addClass(n.cls),a.push(s),r=!0):i=!1:1==n.onChoose||"function"==typeof n.onChoose&&n.onChoose(s,o,!1,!0)?($(s).removeClass(n.cls),a.push(s),r=!1):i=!1):"mouseup"==e.type&&(i=!1,a.length&&t&&"function"==typeof t&&t(o,a,r))}),$(o).off("mouseenter",n.item).on("mouseenter",n.item,function(e){var t=this;0==$(t).hasClass(n.cls)&&i&&r?1==n.onChoose||"function"==typeof n.onChoose&&n.onChoose(t,o,!0,!1)?(a.push(t),$(t).addClass(n.cls)):i=!1:$(t).hasClass(n.cls)&&i&&0==r&&(1==n.onChoose||"function"==typeof n.onChoose&&n.onChoose(t,o,!1,!1)?($(t).removeClass(n.cls),a.push(t)):i=!1)})},clientFileManager=function(){return new ClientFileManager};